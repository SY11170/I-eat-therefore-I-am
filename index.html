<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>2026 吃吃喝喝統計表</title>
    <!-- 引入外部套件 -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700;900&display=swap');
        
        :root {
            --morandi-blue: #91a5b8;
            --morandi-green: #a1b39b;
            --morandi-pink: #b08e8e;
            --morandi-beige: #c7b198;
            --morandi-slate: #7e8a97;
            --bg-color: #f4f6f8;
        }

        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: var(--bg-color);
            color: #546e7a;
            margin: 0;
            -webkit-tap-highlight-color: transparent;
        }

        .glass-card {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 8px 32px rgba(145, 165, 184, 0.1);
        }

        .no-scrollbar::-webkit-scrollbar { display: none; }
        
        @keyframes slideUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-slide-up { animation: slideUp 0.4s ease-out forwards; }

        .lucide-icon { display: inline-flex; align-items: center; justify-content: center; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        // 圖示封裝組件
        const Icon = ({ name, size = 16, className = "" }) => {
            const [svg, setSvg] = useState("");
            useEffect(() => {
                if (window.lucide) {
                    const icon = window.lucide.icons[name];
                    if (icon) setSvg(icon.toSvg({ size, class: className }));
                }
            }, [name, size, className]);
            return <span className={`lucide-icon ${className}`} dangerouslySetInnerHTML={{ __html: svg }} />;
        };

        const App = () => {
            // 狀態管理
            const [currentDate, setCurrentDate] = useState(new Date(2026, 0, 1));
            const [records, setRecords] = useState(() => {
                const saved = localStorage.getItem('diet_tracker_2026_v2');
                return saved ? JSON.parse(saved) : {};
            });
            const [selectedDate, setSelectedDate] = useState(null);
            const [isModalOpen, setIsModalOpen] = useState(false);
            
            // 表單狀態
            const [itemName, setItemName] = useState("");
            const [itemAmount, setItemAmount] = useState("");
            const [itemType, setItemType] = useState("breakfast");

            // 持久化儲存
            useEffect(() => {
                localStorage.setItem('diet_tracker_2026_v2', JSON.stringify(records));
            }, [records]);

            // 類別定義
            const CATEGORIES = {
                breakfast: { label: '早餐', color: 'bg-[#91a5b8]', icon: 'coffee' },
                lunch: { label: '午餐', color: 'bg-[#8297a8]', icon: 'utensils' },
                dinner: { label: '晚餐', color: 'bg-[#a1b39b]', icon: 'utensils-crosses' },
                drinks: { label: '手搖', color: 'bg-[#c7b198]', icon: 'cup-soda' },
                other: { label: '其他', color: 'bg-[#7e8a97]', icon: 'plus' }
            };

            // 月統計
            const stats = useMemo(() => {
                let total = 0;
                let cups = 0;
                const monthPrefix = `${currentDate.getFullYear()}-${String(currentDate.getMonth() + 1).padStart(2, '0')}`;
                
                Object.entries(records).forEach(([date, dayData]) => {
                    if (date.startsWith(monthPrefix)) {
                        dayData.forEach(item => {
                            total += Number(item.amount) || 0;
                            if (item.type === 'drinks') cups += 1;
                        });
                    }
                });
                return { total, cups };
            }, [records, currentDate]);

            // 新增紀錄
            const handleAdd = () => {
                if (!itemName || !itemAmount) return;
                const newRecord = {
                    id: Date.now(),
                    name: itemName,
                    amount: itemAmount,
                    type: itemType,
                    time: new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })
                };
                
                setRecords(prev => ({
                    ...prev,
                    [selectedDate]: [...(prev[selectedDate] || []), newRecord]
                }));
                
                setItemName("");
                setItemAmount("");
            };

            // 刪除紀錄
            const handleDelete = (date, id) => {
                setRecords(prev => ({
                    ...prev,
                    [date]: prev[date].filter(item => item.id !== id)
                }));
            };

            // 月曆生成
            const year = currentDate.getFullYear();
            const month = currentDate.getMonth();
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            const firstDay = new Date(year, month, 1).getDay();

            return (
                <div className="max-w-md mx-auto min-h-screen pb-12 animate-slide-up">
                    {/* Header */}
                    <header className="p-8 pb-4">
                        <div className="flex justify-between items-end mb-6">
                            <div>
                                <h1 className="text-3xl font-black text-[#455a64] tracking-tight">2026 食事帖</h1>
                                <p className="text-xs font-bold text-[#91a5b8] mt-1 uppercase tracking-widest">Morandi Collection</p>
                            </div>
                            <div className="text-right">
                                <p className="text-[10px] font-black text-[#90a4ae] uppercase tracking-[0.2em]">Month Total</p>
                                <p className="text-2xl font-black text-[#91a5b8]">${stats.total.toLocaleString()}</p>
                            </div>
                        </div>

                        <div className="flex items-center justify-between bg-white/60 p-3 rounded-2xl border border-white">
                            <button onClick={() => setCurrentDate(new Date(year, month - 1, 1))} className="p-2 hover:bg-white rounded-xl transition-all"><Icon name="ChevronLeft" size={18}/></button>
                            <span className="font-black text-[#546e7a]">{year} 年 {month + 1} 月</span>
                            <button onClick={() => setCurrentDate(new Date(year, month + 1, 1))} className="p-2 hover:bg-white rounded-xl transition-all"><Icon name="ChevronRight" size={18}/></button>
                        </div>
                    </header>

                    {/* Stats Summary */}
                    <div className="px-8 grid grid-cols-2 gap-4 mb-8">
                        <div className="glass-card p-4 rounded-[2rem] flex flex-col items-center">
                            <div className="bg-[#e9eff5] p-2 rounded-full text-[#91a5b8] mb-2"><Icon name="CupSoda" size={20}/></div>
                            <span className="text-[10px] font-bold text-[#90a4ae]">手搖杯數</span>
                            <span className="text-xl font-black text-[#546e7a]">{stats.cups}</span>
                        </div>
                        <div className="glass-card p-4 rounded-[2rem] flex flex-col items-center">
                            <div className="bg-[#f2f4f2] p-2 rounded-full text-[#a1b39b] mb-2"><Icon name="Wallet" size={20}/></div>
                            <span className="text-[10px] font-bold text-[#90a4ae]">剩餘預算</span>
                            <span className="text-xl font-black text-[#546e7a] italic">--</span>
                        </div>
                    </div>

                    {/* Calendar Grid */}
                    <main className="px-6 mb-8">
                        <div className="glass-card rounded-[2.5rem] p-4 overflow-hidden border border-white">
                            <div className="grid grid-cols-7 mb-2">
                                {['日','一','二','三','四','五','六'].map(d => (
                                    <div key={d} className="text-center text-[10px] font-black text-slate-300 py-2">{d}</div>
                                ))}
                            </div>
                            <div className="grid grid-cols-7 gap-1">
                                {Array(firstDay).fill(null).map((_, i) => <div key={`e-${i}`} className="h-12 md:h-16"></div>)}
                                {Array.from({ length: daysInMonth }).map((_, i) => {
                                    const day = i + 1;
                                    const dateStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                                    const hasData = records[dateStr] && records[dateStr].length > 0;
                                    const isToday = new Date().toDateString() === new Date(year, month, day).toDateString();
                                    
                                    return (
                                        <div 
                                            key={day} 
                                            onClick={() => { setSelectedDate(dateStr); setIsModalOpen(true); }}